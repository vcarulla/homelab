# Glance dashboard configuration
# Copy to: glance/config/glance.yml
# Replace IPs, domains, and API credentials with your values
# Variables like ${PROXMOXVE_URL} come from Vault Agent secrets

theme:
  background-color: 240 8 9
  primary-color: 43 50 70
  contrast-multiplier: 1.1

pages:
  - name: Servicios
    columns:
      - size: full
        widgets:
          - type: monitor
            title: Main Server (192.168.1.10)
            cache: 1m
            sites:
              - title: Traefik
                url: http://traefik.server.example.com/ping
                icon: sh:traefik
              - title: Portainer
                url: https://portainer.server.example.com
                icon: sh:portainer
                allow-insecure: true
              - title: Vault
                url: https://vault.server.example.com
                icon: sh:hashicorp-vault
                allow-insecure: true
              - title: Linkding
                url: https://linkding.server.example.com
                icon: sh:linkding
                allow-insecure: true
              - title: Glance
                url: https://glance.server.example.com
                icon: sh:glance
                allow-insecure: true
              - title: Speedtest
                url: https://speedtest.server.example.com
                icon: sh:speedtest-tracker
                allow-insecure: true

          - type: monitor
            title: Media Server (192.168.1.100)
            cache: 1m
            sites:
              - title: Sonarr
                url: http://192.168.1.100:8989
                icon: sh:sonarr
              - title: Radarr
                url: http://192.168.1.100:7878
                icon: sh:radarr
              - title: Prowlarr
                url: http://192.168.1.100:9696
                icon: sh:prowlarr
              - title: qBittorrent
                url: http://192.168.1.100:8080
                icon: sh:qbittorrent
              - title: Emby
                url: http://192.168.1.100:8096
                icon: sh:emby
              - title: Bazarr
                url: http://192.168.1.100:6767
                icon: sh:bazarr
              - title: Plex
                url: http://192.168.1.100:32400/identity
                icon: sh:plex

          - type: monitor
            title: Other Services
            cache: 1m
            sites:
              - title: Home Assistant
                url: http://192.168.1.50:8123/manifest.json
                icon: sh:home-assistant
              - title: Proxmox
                url: https://192.168.1.10:8006
                icon: sh:proxmox
                allow-insecure: true
              - title: n8n
                url: https://n8n.automation.example.com
                icon: sh:n8n
                allow-insecure: true

      - size: small
        widgets:
          - type: server-stats
            servers:
              - type: local
                name: Server

          - type: docker-containers
            title: Containers
            containers:
              traefik:
                icon: sh:traefik
              portainer:
                icon: sh:portainer
              vault:
                icon: sh:hashicorp-vault
              homelab-vault-agent:
                icon: sh:hashicorp-vault
              linkding:
                icon: sh:linkding
              glance:
                icon: sh:glance
              speedtest-tracker:
                icon: sh:speedtest-tracker

  - name: Infraestructura
    columns:
      - size: full
        widgets:
          # Proxmox integration - requires API token from Vault
          - type: custom-api
            title: Proxmox Cluster
            cache: 1m
            url: https://${PROXMOXVE_URL}/api2/json/cluster/resources
            allow-insecure: true
            headers:
              Accept: application/json
              Authorization: PVEAPIToken=${PROXMOXVE_KEY}
            template: |
              <div class="flex flex-column gap-5">
                <div class="flex justify-between text-center">
                  <div>
                    {{ $nodes_online := len (.JSON.Array "data.#(type==\"node\")#|#(status==\"online\")#") }}
                    {{ $nodes_total := len (.JSON.Array "data.#(type==\"node\")#") }}
                    <div class="color-highlight size-h3">{{ $nodes_online }}/{{ $nodes_total }}</div>
                    <div class="size-h5 uppercase">Node</div>
                  </div>
                  <div>
                    {{ $lxc_running := len (.JSON.Array "data.#(type==\"lxc\")#|#(status==\"running\")#|#(template==0)#") }}
                    {{ $lxc_total := len (.JSON.Array "data.#(type==\"lxc\")#|#(template==0)#") }}
                    <div class="color-highlight size-h3">{{ $lxc_running }}/{{ $lxc_total }}</div>
                    <div class="size-h5 uppercase">LXC</div>
                  </div>
                  <div>
                    {{ $qemu_running := len (.JSON.Array "data.#(type==\"qemu\")#|#(status==\"running\")#|#(template==0)#") }}
                    {{ $qemu_total := len (.JSON.Array "data.#(type==\"qemu\")#|#(template==0)#") }}
                    <div class="color-highlight size-h3">{{ $qemu_running }}/{{ $qemu_total }}</div>
                    <div class="size-h5 uppercase">VM</div>
                  </div>
                  <div>
                    {{ $storage_available := len (.JSON.Array "data.#(type==\"storage\")#|#(status==\"available\")#") }}
                    {{ $storage_total := len (.JSON.Array "data.#(type==\"storage\")#") }}
                    <div class="color-highlight size-h3">{{ $storage_available }}/{{ $storage_total }}</div>
                    <div class="size-h5 uppercase">Storage</div>
                  </div>
                </div>
              </div>

          # Portainer integration - requires API key from Vault
          - type: group
            widgets:
              - type: custom-api
                title: Portainer Main
                cache: 1h
                url: ${PORTAINER_URL}/api/endpoints/1
                allow-insecure: true
                headers:
                  X-API-Key: ${PORTAINER_API_KEY}
                template: |
                  <div class="margin-block-2">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                      <div>
                        <div class="size-h5">Running</div>
                        <div class="size-h3 color-highlight">{{ .JSON.Int "Snapshots.0.RunningContainerCount" }}</div>
                      </div>
                      <div>
                        <div class="size-h5">Healthy</div>
                        <div class="size-h3 color-highlight">{{ .JSON.Int "Snapshots.0.HealthyContainerCount" }}</div>
                      </div>
                      <div>
                        <div class="size-h5">Stopped</div>
                        <div class="size-h3 color-highlight">{{ .JSON.Int "Snapshots.0.StoppedContainerCount" }}</div>
                      </div>
                      <div>
                        <div class="size-h5">Containers</div>
                        <div class="size-h3 color-highlight">{{ .JSON.Int "Snapshots.0.ContainerCount" }}</div>
                      </div>
                    </div>
                  </div>

          # Speedtest integration - requires API token from Vault
          - type: custom-api
            title: Internet Speed
            title-url: ${SPEEDTEST_URL}
            cache: 1h
            url: ${SPEEDTEST_URL}/api/v1/results/latest
            allow-insecure: true
            headers:
              Authorization: Bearer ${SPEEDTEST_TRACKER_API_TOKEN}
              Accept: application/json
            template: |
              {{ $downloadBits := .JSON.Float "data.download_bits" }}
              {{ $uploadBits := .JSON.Float "data.upload_bits" }}
              {{ $ping := .JSON.Float "data.ping" }}
              {{ $downloadMbps := div $downloadBits 1000000.0 }}
              {{ $uploadMbps := div $uploadBits 1000000.0 }}
              <div class="flex justify-between text-center">
                <div>
                  <div class="color-highlight size-h3">{{ printf "%.0f" $downloadMbps }}</div>
                  <div class="size-h5">Mbps Down</div>
                </div>
                <div>
                  <div class="color-highlight size-h3">{{ printf "%.0f" $uploadMbps }}</div>
                  <div class="size-h5">Mbps Up</div>
                </div>
                <div>
                  <div class="color-highlight size-h3">{{ printf "%.1f" $ping }}</div>
                  <div class="size-h5">ms Ping</div>
                </div>
              </div>

  - name: Feeds
    columns:
      - size: small
        widgets:
          - type: calendar
            first-day-of-week: monday

          - type: rss
            title: RSS Feed
            limit: 10
            feeds:
              - url: https://feeds.arstechnica.com/arstechnica/technology-lab
                title: Ars Technica
              - url: https://www.theverge.com/rss/index.xml
                title: The Verge
              - url: https://selfh.st/rss/
                title: selfh.st

          - type: twitch-channels
            title: Twitch Channels
            channels:
              - dave_eddy
              - tsoding

      - size: full
        widgets:
          - type: group
            widgets:
              - type: hacker-news
                title: Hacker News
                limit: 15
              - type: lobsters
                title: Lobsters
                limit: 15

          - type: videos
            title: Videos
            channels:
              - UCR-DXc1voovS8nhAvccRZhg  # Jeff Geerling
              - UCsBjURrPoezykLs9EqgamOA  # Fireship
              - UC9x0AN7BWHpCDHSm9NiJFJQ  # NetworkChuck

          - type: group
            widgets:
              - type: reddit
                title: r/selfhosted
                subreddit: selfhosted
                style: horizontal-cards
                limit: 5
                show-thumbnails: true
              - type: reddit
                title: r/homelab
                subreddit: homelab
                style: horizontal-cards
                limit: 5
                show-thumbnails: true

      - size: small
        widgets:
          - type: weather
            location: Buenos Aires, Argentina
            units: metric

          - type: releases
            title: Releases
            cache: 6h
            limit: 20
            repositories:
              - glanceapp/glance
              - traefik/traefik
              - hashicorp/vault
              - portainer/portainer
              - sissbruecker/linkding
              - Sonarr/Sonarr
              - Radarr/Radarr
              - home-assistant/core
